Инструкция по установке модуля

1. Для установки платежного модуля BeGateway необходимо произвести следующие действия:

    Скачайте архив модуля и распакуйте его. Загрузите архив в папку core/packages/ вашего сайта.
    В панели управления перейдите "Система" - "Управление пакетами" - "Добавить новый пакет" - "Искать пакеты локально" - "Дальше".
    В таблице пакетов появится пакет "begateway". Нажмите кнопку "Установить".
    Завершите установку.

2. Необходимо проверить, что созданы 4 страницы:

    1 - страница оплаты через BeGateWay ( "Оплатить заказ" ).
    Поле "Содержимое ресурса" должно быть следующим:

        [[!begateway? action=`payment`]]

        Шаблон Начальный или пользовательский для вывода сообщений и текстовых страниц

    2 - страница с сообщением об успешной оплате ( "Спасибо за заказ" ).
    Поле "Содержимое ресурса" должно быть следующим:

        [[!begateway? action=`success`]]

        Шаблон Начальный или пользовательский для вывода сообщений и текстовых страниц

    3 - страница с сообщением о неуспешной оплате ( "Ошибка оплаты" ).
    Поле "Содержимое ресурса" должно быть следующим:

        [[!begateway? action=`fail`]]

        Шаблон Начальный или пользовательский для вывода сообщений и текстовых страниц

    4 - страница для уведомлений об оплате ( "Begateway Notify" ).
    Поле "Содержимое ресурса" должно быть следующим:

        [[!begateway? action=`notify`]]

        Шаблон Пустой (без шаблона)

    Все эти ресурсы должны быть опубликованы и скрыты из меню.

3. Измените параметры сниппета BeGateWay:

    'shopId' - ID магазина в платежной системе
    'shopSecretKey' - Секретный ключ магазина в платежной системе
    'shopPublicKey' - Публичный ключ магазина в платежной системе (не обязательное, но очень рекомендуемое поле)
    'paymentDomain' - Домен платежной страницы
    'test' - Включить режим работы Тестовый (Да/Нет)
    'currency' - Код валюта по-умолчанию (указывается код валюты вашей платежной системы)
    'currencyMode' - Режим выставления счета на оплату (в валюте по-умолчанию или в валюте выбранной пользователем, смотрите раздел мультивалютность)
    'redirectMode' - Режим перевода пользователя на страницу оплаты (сразу после нажатия на кнопку "Оформить заказ" или с выводом страницы инвойса и кнопкой "Оплатить")
    'chunkOrderDetail' - Чанк для вывода Инвойса перед оплатой
    'chunkOrderDetailRow' - Чанк строки товаров в инвойсе
    'chunkOrderContactsRow' - Чанк вывода контактов покупателя в инвойсе
    'chunkOrderTryAgainDetail' - Чанк для вывода инвойса если оплата не удалась (инвойс для страницы попробовать оплатить еще раз)
    'chunkOrderSuccessPaid' - Чанк для вывода сообщения об успешной оплате и успешном заказе
    'pagePayment' - Id ресурса "Оплатить заказ"
    'pageSuccess' - Id ресурса "Спасибо за заказ"
    'pageFailure' - Id ресурса "Ошибка оплаты"
    'pageNotify' - Id ресурса "Begateway Notify"
    'statusNew' - Id статуса "Новый заказ" (порядковый номер, обычно статус Новый стоит первым - 1)
    'statusAccept' - Id статуса "Принят к оплате" (порядковый номер, обычно статус Приянт к оплате стоит вторым - 2)
    'statusCancel' - Id статуса "Заказ отменен" (порядковый номер, обычно статус Отменен стоит пятым - 5)
    'statusPaid' - Id статуса "Оплата получена" (порядковый номер, обычно статус Оплата получена стоит шестым - 6)

4. Настроить методы оплаты Shopkeeper3.

    В главном меню выберите «Пакеты» — «Управление заказами (SHK3)»

    В правом верхнем углу нажмите кнопку = и выберите «настройки»

    Выберите настройку «Методы оплаты»

    Нажмите кнопку «Добавить» и заполните поля «Название» и «Значение». Поле «Название» может быть произвольным — это текстовое представление типа оплаты в форме заказа, например “Оплата картой”.
    Поле «Значение» обязательно должно содержать слово «begateway» без заглавных букв, именно это слово передается формой оплаты в параметре «payment».

    На странице формы оформления заказа в вызове сниппета FormIt в список используемых хуков необходимо добавить begateway перед redirect.

        [[!FormIt?
            &hooks=`spam,shk_fihook,email,FormItAutoResponder,begateway,redirect`
            &submitVar=`order`
            &emailTpl=`shopOrderReport`
            &fiarTpl=`shopOrderReport`
            &emailSubject=`В интернет-магазине "[[++site_name]]" сделан новый заказ`
            &fiarSubject=`Вы сделали заказ в интернет-магазине "[[++site_name]]"`
            &emailTo=`[[++emailsender]]`
            &fiarReplyTo=`[[++emailsender]]`
            &fiarToField=`email`
            &emailFrom=`[[++emailsender]]`
            &emailFromName=`[[++emailsender]]`
            &fiarFrom=`[[++emailsender]]`
            &redirectTo=`8`
            &validate=`fullname:required,address:required,email:email:required,phone:required,shk_delivery:required,payment:required`
            &errTpl=`<br /><span class="error">[[+error]]</span>`
        ]]

5. Мультивалютность

    Должен быть включен плагин shk_multicurrency

    В настройках снипета begateway укажите код валюты по умолчанию для вашей платежной системы
    ВАЖНО! В настройках валют она должна быть первая либо в настройках системы в разделе shopkeeper3 -> shk3.currency_default указан номер очередности валюты по умолчанию

    Выберите вариант выставления счетов клиенту (в валюте по умолчанию или в валюте пользователя)

    Если в валюте по умолчанию следите за курсом валют в настройках shopkeeper3, иначе возможны сильные расхождения в указанной сумме у пользователя на экране и его списании с карты.

    Если в валюте пользователя
    ВАЖНО! В настройках shopkeeper3 в списке валют название валюты указывайте в виде кода валюты
    Например рубли указывать не руб. - а RUB, доллары сша не $ или доллары - а USD и так далее.

Удачных платежей.
